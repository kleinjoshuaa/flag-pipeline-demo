template:
  name: CreateMultivariateDef
  type: Step
  spec:
    type: Http
    spec:
      url: https://api.split.io/internal/api/v2/splits/ws/<+pipeline.variables.Workspace>/<+pipeline.variables.flagName>/environments/<+pipeline.variables.Environment>
      method: POST
      headers:
        - key: Content-Type
          value: application/json
        - key: Authorization
          value: Bearer <+secrets.getValue("splitApiKey")>
      inputVariables: []
      outputVariables: []
      requestBody: |-
        {"treatments": [
                        {
                            "name": "current",
                            "description": ""
                            
                        },
                        {
                            "name": "standard",
                            "description": ""
                      }, {
                            "name": "premium",
                            "description": ""
                      }
                    ],
                    "defaultTreatment": "current",
                    "baselineTreatment": "current",
                    "trafficAllocation": 100,
                    "rules": [],
                    "defaultRule": [
                        {
                            "treatment": "current",
                            "size": 100
                        }
                    ]}
      assertion: <+httpResponseCode>==200
    timeout: 10s
  identifier: CreateMultivariateDef
  versionLabel: Version1
